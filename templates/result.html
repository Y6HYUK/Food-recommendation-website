<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>음식 추천 결과</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // 로딩 스피너 표시 시간 (밀리초 단위)
            const loadingTime = 2000; // 2초

            // 추천 결과를 담을 요소
            const recommendationElement = document.getElementById("recommendation");
            const reasonElement = document.getElementById("reason");

            // 추천 결과 요소를 숨김
            recommendationElement.style.display = "none";
            reasonElement.style.display = "none";

            // 타이핑 효과 함수
            function typeText(element, text, delay = 50, callback = null) {
                let index = 0;
                element.innerHTML = "";
                element.style.display = "block";
                const timer = setInterval(() => {
                    if (index < text.length) {
                        element.innerHTML += text.charAt(index);
                        index++;
                    } else {
                        clearInterval(timer);
                        if (callback) callback();
                    }
                }, delay);
            }

            // 로딩 스피너 후 타이핑 효과 실행
            setTimeout(() => {
                document.getElementById("loader").style.display = "none";

                // 추천 결과 타이핑
                {% if recommendation is string %}
                    typeText(recommendationElement, "추천 음식: {{ recommendation }}", 30, () => {
                        typeText(reasonElement, "{{ reason }}", 30);
                    });
                {% else %}
                    typeText(recommendationElement, "{{ reason }}", 30, () => {
                        // 대안 음식 목록 표시
                        const list = document.getElementById("recommendation-list");
                        const foods = {{ recommendation | tojson }};
                        foods.forEach(food => {
                            const li = document.createElement("li");
                            li.textContent = food;
                            list.appendChild(li);
                        });
                        document.getElementById("alternative-text").style.display = "block";
                        document.getElementById("alternative-container").style.display = "block";
                    });
                {% endif %}
            }, loadingTime);
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>음식 추천 결과</h1>

        <!-- 선택 목록 텍스트 -->
        <div id="selection-container">
            <h2>선택 목록</h2>
            <ul id="selection-list">
                {% for key, value in selected_conditions.items() %}
                    {% if value %}
                        <li><strong>{{ key }}:</strong> {{ value }}</li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>

        <!-- 로딩 스피너 -->
        <div id="loader" class="spinner"></div>

        <!-- 추천 음식 (조건에 맞는 경우) -->
        <div id="recommendation-container">
            <h2 id="recommendation" style="display: none;"></h2>
            <p id="reason" style="display: none;"></p>
        </div>

        <!-- 대안 음식 (조건에 맞지 않는 경우) -->
        {% if recommendation is not string %}
            <div id="alternative-container" style="display: none;">
                <h2 id="alternative-text" style="display: none;">{{ reason }}</h2>
                <ul id="recommendation-list"></ul>
                <p>위 음식들 중 하나를 선택해보세요!</p>
            </div>
        {% endif %}

        <a href="/">다시 추천 받기</a>
    </div>
</body>
</html>
